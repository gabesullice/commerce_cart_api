<?php

/**
 * @file
 * Provides hooks.
 */

use Drupal\commerce_cart_api\Plugin\Field\FieldType\FormattablePriceItem;
use Drupal\commerce_order\Entity\OrderInterface;
use Drupal\Core\Field\FieldDefinitionInterface;
use Drupal\Core\Field\FieldItemListInterface;
use Drupal\Core\Session\AccountInterface;

/**
 * Implements hook_entity_field_access().
 */
function commerce_cart_api_entity_field_access($operation, FieldDefinitionInterface $field_definition, AccountInterface $account, FieldItemListInterface $items = NULL) {
  $field_access = \Drupal::getContainer()->get('commerce_cart_api.field_access');
  return $field_access->handle($operation, $field_definition, $account, $items);
}

/**
 * Implements hook_entity_access().
 */
function commerce_cart_api_entity_access(\Drupal\Core\Entity\EntityInterface $entity, $operation, \Drupal\Core\Session\AccountInterface $account) {
  if (($entity instanceof OrderInterface) && $operation === 'view') {
    $cart_session = \Drupal::getContainer()->get('commerce_cart.cart_provider');
    $cart_ids = $cart_session->getCartIds($account);
    return \Drupal\Core\Access\AccessResult::allowedIf(in_array((int) $entity->id(), $cart_ids, TRUE));
  }
}
